<script>
function playvideo(videoId, coordinatesOfVideo, videoTitle) {
    var videoMarker = document.getElementById(videoId + "-marker");
    var mediaVideo = $("#" + videoId).get(0);
    map.flyTo({
        center: coordinatesOfVideo,
        speed: 0.2,
        });



    if (mediaVideo.paused) {
        document.title = videoTitle;

        var els = document.querySelectorAll('.markerZoomIn')

        _removeClasses()

        function _removeClasses() {
            for (var i = 0; i < els.length; i++) {
                console.log(els[i].id.replace('-marker','-hiddenDeck'));
                var deckToHide = els[i].id.replace('-marker', '-hiddenDeck');
                document.getElementById(deckToHide).style.display = "none";
                els[i].classList.remove('markerZoomIn');
                document.querySelectorAll('video').forEach(vid => vid.pause());

         
            }
        }

        videoMarker.classList.remove('markerZoomOut');
        videoMarker.classList.add('markerZoomIn');

        $.ajax({
        type: 'POST',
        url: '/f/video/' + videoMarker.id.replace("-marker", "") + '/visualization',
        data: {
            'csrfmiddlewaretoken': $("input[name=csrfmiddlewaretoken]").val()
        },
        success: videoWasViewed,
    });

    function videoWasViewed(data, textStatus, jqXHR){
        //Maybe return new views value
    }            
            
        

        mediaVideo.play();
        
        mediaVideo.ontimeupdate = function(){
        var percentage = ( mediaVideo.currentTime / mediaVideo.duration ) * 100;
            $("#progressbar" + videoId).css("width", percentage+"%");
        };

        if ($( "#" + videoId + "-marker" ).hasClass( "markerZoomIn" )) {
            document.getElementById(videoId + "-hiddenDeck").style.display = 'block';
        }
        
        if ($( "#" + videoId + "-marker" ).hasClass( "markerZoomOut" )) {
            document.getElementById(videoId + "-hiddenDeck").style.display = 'none';
        }

    } else {
        mediaVideo.pause();


        document.title = "Latytube";
        var videoMarker = document.getElementById(videoId+ "-marker");
        videoMarker.classList.remove("markerZoomIn");
        videoMarker.classList.add('markerZoomOut');
        if ($( "#" + videoId + "-marker" ).hasClass( "markerZoomIn" )) {
            document.getElementById(videoId + "-hiddenDeck").style.display = 'block';
        }
        if ($( "#" + videoId + "-marker" ).hasClass( "markerZoomOut" )) {
            document.getElementById(videoId + "-hiddenDeck").style.display = 'none';
        }
    }
}

    function likevideo(liked_video_id){
        $.ajax({
            type: 'POST',
            url: '/f/video/' + liked_video_id + '/like',
            data: {
                'csrfmiddlewaretoken': $("input[name=csrfmiddlewaretoken]").val()
            },
            success: console.log,
        });
    }
</script>
